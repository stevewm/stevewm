#
# Updates README.md with latest commit dates
# for repos listed in `config.yaml`
#

name: "Update README.md"
on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'
  push:
    branches:
      - main
    paths: 
      - README.md.j2
      - repos.py

permissions:
  contents: write

jobs:
  readme:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Install uv
      uses: astral-sh/setup-uv@v5

    - name: Run Script
      shell: bash
      env:
        GITHUB_USER: ${{ github.repository_owner }}
        GITHUB_TOKEN: ${{ secrets.READ_REPO_TOKEN }}
      run: uv run repos.py
    
    - name: Update README.md
      uses: EndBug/add-and-commit@v9
      with:
        add: "README.md"
        message: "chore: update README.md"
        committer_name: "botty-hill[bot]"
        committer_email: botty-hill[bot]@users.noreply.github.com
